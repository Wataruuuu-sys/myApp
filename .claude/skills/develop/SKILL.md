---
description: TDDを主体とした開発ワークフロー
---

# 開発ワークフロー
要件追加・リファクタリング・新規開発におけるコード修正の標準フローです。
---
## 1. 要件追加・リファクタリングの場合
### Step 1: TDD (RED) - 失敗するテストを書く
1. **要件を理解する**: 何を達成したいか明確にする
2. **テストケースを設計する**: 期待する振る舞いをテストとして表現
3. **テストを実装する**: コンパイルは通るが、テストは **失敗する** 状態にする
4. **失敗を確認する**: `bun test` で RED（失敗）を確認
```bash
# テスト実行（失敗することを確認）
bun test --tests "対象テストクラス"
```
### Step 2: IMPL - 実装
1. **最小限の実装**: テストを通すための最小限のコードを書く
2. **リファクタリングは後回し**: まずは動くコードを優先
### Step 3: TDD (GREEN) - テストを通す
1. **テスト実行**: `bun test --tests "対象テストクラス"` で GREEN（成功）を確認
2. **全テスト実行**: 既存テストへの影響がないことを確認
```bash
# 全テスト実行
bun test
```
### Step 4: 自己レビュー（3つの観点）
#### 4.1 ユーザー立場推論の観点
- この修正を依頼したユーザーの本当の目的は何か？
- ユーザーが暗黙的に期待していることを満たしているか？
- ビジネス要件・運用要件を考慮しているか？
#### 4.2 自己否定の観点
- この実装で本当に問題ないか？
- エッジケースを見落としていないか？
- パフォーマンス・メモリ使用量は適切か？
- スレッドセーフ性は担保されているか？
#### 4.3 悪魔の代弁者（Devil's Advocate）
- 「この実装は間違っている」と仮定した場合、どのような反論ができるか？
- 最悪のシナリオを想定した場合、何が起こりうるか？
- セキュリティ上の問題はないか？
### Step 5: 静的解析・フォーマット対応
プロジェクトごとの静的解析ツールとフォーマッターを実行：
```bash
bun run lint
bun run format
```

## チェックリスト
### TDD (RED)
- [ ] テストケースが要件を正しく表現している
- [ ] テストが失敗することを確認した
### IMPL
- [ ] 最小限の実装でテストを通した
- [ ] コードがコンパイルできる
### TDD (GREEN)
- [ ] 対象テストが成功する
- [ ] 既存テストに影響がない
### 自己レビュー
- [ ] ユーザー立場推論: 本当の目的を満たしている
- [ ] 自己否定: エッジケースを考慮している
- [ ] 悪魔の代弁者: 反論に対する回答ができる
### 静的解析・フォーマット
- [ ] lint が通る
- [ ] format が適用されている
---
## 注意事項
- **RED -> GREEN の順序を厳守**: 最初に失敗するテストを書くことで、テストが意味のあるものであることを確認する
- **自己レビューは省略しない**: 特に悪魔の代弁者の観点は重要
- **静的解析エラーは即座に修正**: PR作成前に必ず解消する
